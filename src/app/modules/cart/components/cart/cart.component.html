<app-toolbar-navigation></app-toolbar-navigation>

<h1>Meu Carrinho ({{ getTotalItems() }} itens)</h1>

<div *ngIf="cartItems.length === 0">Seu carrinho está vazio.</div>

<div class="cart-list" *ngIf="cartItems.length > 0">
  <div class="cart-item" *ngFor="let item of cartItems">
    <div class="item-info">
      <strong>{{ item.jewel.name }} ({{ item.quantity }}x)</strong>
      <p>Preço unitário: {{ item.jewel.price | currency : "BRL" }}</p>
      <p>Subtotal: {{ item.jewel.price * item.quantity | currency : "BRL" }}</p>

      <div class="quantity-controls">
        <button
          pButton
          icon="pi pi-minus"
          class="p-button-rounded p-button-secondary"
          (click)="decreaseQuantity(item._id, item.quantity)"
        ></button>
        <span>{{ item.quantity }}</span>
        <button
          pButton
          icon="pi pi-plus"
          class="p-button-rounded p-button-secondary"
          (click)="increaseQuantity(item._id, item.quantity)"
        ></button>
      </div>
    </div>

    <button
      pButton
      icon="pi pi-trash"
      class="p-button-rounded p-button-danger"
      (click)="removeFromCart(item._id)"
    ></button>
  </div>
</div>

<!-- Subtotal -->
<div *ngIf="cartItems.length > 0" class="subtotal-container">
  <h3>Subtotal: {{ getSubtotal() | currency : "BRL" }}</h3>
  <button
    pButton
    label="Finalizar Compra"
    icon="pi pi-check"
    class="p-button-success"
    (click)="checkoutDialogVisible = true"
  ></button>
</div>

<!-- Modal de confirmação -->
<p-dialog
  header="Confirmação de Compra"
  [(visible)]="checkoutDialogVisible"
  [modal]="true"
  [dismissableMask]="true"
  [style]="{ width: '400px' }"
>
  <p>Tem certeza de que deseja finalizar esta compra?</p>
  <div class="p-dialog-footer">
    <button
      pButton
      label="Cancelar"
      icon="pi pi-times"
      (click)="checkoutDialogVisible = false"
      class="p-button-text"
    ></button>
    <button
      pButton
      label="Confirmar"
      icon="pi pi-check"
      (click)="finalizePurchase()"
      class="p-button-success"
    ></button>
  </div>
</p-dialog>

<p-card>
  <div class="paypal-container">
    <div id="paypal-button-container"></div>
  </div>
</p-card>
